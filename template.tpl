
b3eeb3efd902e27c7197933bb1ec9ed3e5f15ea7

// old
30498c1d01e3a94f0b3ce4ee417de2dba7cdfd8b
___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Ascend by Partnerize",
  "categories": [
    "AFFILIATE_MARKETING",
    "ADVERTISING"
  ],
  "brand": {
    "id": "github.com_pepperjam",
    "displayName": "Ascend by Partnerize",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Ascend Tag by Partnerize is used to implement the Container Tag and Conversion Tag. You will need your Container Tag ID and Program ID.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "tagType",
    "displayName": "Tag Type",
    "selectItems": [
      {
        "value": "container",
        "displayValue": "Container Tag"
      },
      {
        "value": "conversion",
        "displayValue": "Conversion Tag"
      }
    ],
    "simpleValueType": true,
    "help": "Select which tag"
  },
  {
    "type": "GROUP",
    "name": "container",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "TEXT",
        "name": "advertiserID",
        "displayName": "Container Tag ID",
        "simpleValueType": true,
        "help": "Unique ID required for each advertiser. The ID can be found here: https://www.ascendpartner.com/merchant/integration on the Container Tag tab or you can reach out to your account manager",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "customDomainCheckbox1",
        "checkboxText": "Enable Custom Domain",
        "simpleValueType": true,
        "alwaysInSummary": true,
        "help": "\u003cli\u003eThe host part of the uri https://ascend.my-domain.com should match your primary domain.\u003c/li\u003e\n\u003cli\u003eThe sub-domain part of the uri https://ascend.my-domain.com will be a separate sub-domain setup for the purpose of integrating with the feature. It will need to be separate from any other sub-domain currently in use. Ascend is used as a placeholder in this instance.\u003c/li\u003e \n\u003cli\u003eYour custom domain must be provisioned in ascend before you can complete the integration.\u003c/li\u003e\n\u003cli\u003e Your custom domain must match the exact value entered in Ascend.\u003c/li\u003e\n\u003cli\u003e You can set up your domain in Ascend \u003ca href\u003d \"https://www.ascendpartner.com/merchant/integration/tracking-domains\"\u003ehere.\u003c/a\u003e\u003c/li\u003e\n\n\u003cbr\u003e\u003c/br\u003e\nIf you change this from the default, you \u003cstrong\u003emust\u003c/strong\u003e edit the Permissions of the tag template accordingly.",
        "subParams": [
          {
            "type": "TEXT",
            "name": "customDomain1",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "customDomainCheckbox1",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "valueHint": "subdomain.yourdomain.com",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "REGEX",
                "args": [
                  "^(?!https://).*"
                ],
                "errorMessage": "Please enter only the hostname. Please remove the \"https://\" or \"http://."
              }
            ]
          }
        ],
        "enablingConditions": []
      }
    ],
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "container",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "conversion",
    "displayName": "",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "TEXT",
        "name": "programID",
        "displayName": "Program ID",
        "simpleValueType": true,
        "help": "Enter your Ascend program ID. Contact your Ascend account rep if you don\u0027t have this number",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "customDomainCheckbox2",
        "checkboxText": "Enable Custom Domain",
        "simpleValueType": true,
        "alwaysInSummary": true,
        "help": "\u003cli\u003eThe host part of the uri https://ascend.my-domain.com should match your primary domain.\u003c/li\u003e\n\u003cli\u003eThe sub-domain part of the uri https://ascend.my-domain.com will be a separate sub-domain setup for the purpose of integrating with the feature. It will need to be separate from any other sub-domain currently in use. Ascend is used as a placeholder in this instance.\u003c/li\u003e \n\u003cli\u003eYour custom domain must be provisioned in ascend before you can complete the integration.\u003c/li\u003e\n\u003cli\u003e Your custom domain must match the exact value entered in Ascend.\u003c/li\u003e\n\u003cli\u003e You can set up your domain in Ascend \u003ca href\u003d \"https://ascend.pepperjam.com/merchant/integration/tracking-domains\"\u003ehere.\u003c/a\u003e\u003c/li\u003e\n\n\u003cbr\u003e\u003c/br\u003e\nIf you change this from the default, you \u003cstrong\u003emust\u003c/strong\u003e edit the Permissions of the tag template accordingly.",
        "subParams": [
          {
            "type": "TEXT",
            "name": "customDomain2",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "customDomainCheckbox2",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "valueHint": "suddomain.yourdomain.com",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "REGEX",
                "args": [
                  "^(?!https://).*"
                ],
                "errorMessage": "Please enter only the hostname. Please remove the \"https://\" or \"http://."
              }
            ]
          }
        ],
        "enablingConditions": []
      },
      {
        "type": "SELECT",
        "name": "dataLayerType",
        "displayName": "Transaction Object",
        "selectItems": [
          {
            "value": "gtm_ga4",
            "displayValue": "Enhanced Ecommerce Data Layer (GA4)"
          },
          {
            "value": "gtm",
            "displayValue": "Enhanced Ecommerce Data Layer (UA)"
          },
          {
            "value": "udv",
            "displayValue": "User Defined Variable"
          }
        ],
        "simpleValueType": true,
        "help": "If your container is currently using GTM\u0027s enhance ecommerce feature select \"Enhanced Ecommerce Data Layer\". If you are currently not using that feature select \"User Defined Variable\". Refer to Ascend\u0027s documentation on how to create the user defined variable."
      },
      {
        "type": "GROUP",
        "name": "userDefinedGroup",
        "groupStyle": "NO_ZIPPY",
        "subParams": [
          {
            "type": "TEXT",
            "name": "userVar",
            "displayName": "User Defined Variable",
            "simpleValueType": true,
            "help": "Ensure that the user defined variable returns a string with the parameters in the proper order. ORDER_ID\u003d\u003cORDER_ID\u003e\u0026ITEM_ID1\u003d\u003cITEM_ID\u003e\u0026ITEM_PRICE1\u003d\u003cITEM_PRICE\u003e\u0026QUANTITY1\u003d\u003cQUANTITY\u003e\u0026CATEGORY1\u003d\u003cCATEGORY\u003e\u0026COUPON\u003d\u003cCOUPON\u003e,\u003cCOUPON\u003e"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "dataLayerType",
            "paramValue": "udv",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "pixelTypeValidation",
        "checkboxText": "Transaction Type Parameter (Optional)",
        "simpleValueType": true,
        "help": "Transaction Type If not supplied, sale is assumed.",
        "subParams": [
          {
            "type": "SELECT",
            "name": "pixelType",
            "macrosInSelect": true,
            "selectItems": [
              {
                "value": 1,
                "displayValue": "sale"
              },
              {
                "value": 2,
                "displayValue": "lead"
              }
            ],
            "simpleValueType": true,
            "defaultValue": 1,
            "enablingConditions": [
              {
                "paramName": "pixelTypeValidation",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "userTypeValidation",
        "checkboxText": "User Type Parameter (Optional)",
        "simpleValueType": true,
        "help": "Whether or not the customer that placed the order is a new customer in your system using whatever business logic you deem appropriate.  Note: This value should be 1 (one) if the customer is new or 0 (zero) if the customer is not new.",
        "subParams": [
          {
            "type": "TEXT",
            "name": "userType",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "userTypeValidation",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "segment",
        "checkboxText": "Custom Segment (Optional)",
        "simpleValueType": true,
        "help": "Custom Segment can be used to pass any attribute that is meaningful to you with the order. It should be in a STRING(64) format.",
        "subParams": [
          {
            "type": "TEXT",
            "name": "segmentType",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "segment",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "optionalFieldsGTM",
        "displayName": "Optional Product Parameters",
        "groupStyle": "ZIPPY_CLOSED",
        "subParams": [
          {
            "type": "CHECKBOX",
            "name": "categoryCheckbox",
            "checkboxText": "Item Category",
            "simpleValueType": true,
            "help": "Enable to collect item category data"
          },
          {
            "type": "CHECKBOX",
            "name": "couponCheckbox",
            "checkboxText": "Transaction/Item Coupon",
            "simpleValueType": true,
            "help": "Enable to collect transaction/item coupon data"
          },
          {
            "type": "CHECKBOX",
            "name": "currencyCheckbox",
            "checkboxText": "Currency",
            "simpleValueType": true,
            "subParams": [
              {
                "type": "TEXT",
                "name": "currency",
                "displayName": "Currency",
                "simpleValueType": true,
                "defaultValue": "USD",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  }
                ],
                "enablingConditions": [
                  {
                    "paramName": "currencyCheckbox",
                    "paramValue": true,
                    "type": "EQUALS"
                  }
                ]
              }
            ],
            "help": "The expected value of this parameter is the ISO 4217 3 letter currency code for the currency. I.E. USD, CAD, EUR, etc."
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "conversion",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Require the necessary APIs
const injectScript = require("injectScript");
const queryPermission = require("queryPermission");
const injectIframe = require("injectHiddenIframe");
const log = require("logToConsole");
const getDL = require("copyFromDataLayer");
const encodeUriComponent = require("encodeUriComponent");
const makeString = require("makeString");

//Tag Inputs
const tagType = data.tagType;
//Container Tag
//Container ID
const aID = data.advertiserID;
const cdCheckbox1 = data.customDomainCheckbox1;
const cd1 = data.customDomain1;
//Conversion Tag
//Program ID
const programID = data.programID;
const cdCheckbox2 = data.customDomainCheckbox2;
const cd2 = data.customDomain2;
//dropDown Input
const pixelTypeValidation = data.pixelTypeValidation;
//dropDown Value
const pixelType = data.pixelType;
//User Type Checkbox
const userTypeValidation = data.userTypeValidation;
const userType = data.userType;
//dataLayerType
const dataLayerType = data.dataLayerType;

//Optional Parameter - GTM Data Layer
const currencyCheckbox = data.currencyCheckbox;
const currency = data.currency;
const categoryCheckbox = data.categoryCheckbox;
const couponCheckbox = data.couponCheckbox;
const segment = data.segment;
const segmentType = data.segmentType;

//User Defined Variable
const userVar = data.userVar;

const urlSRC = [];
const couponArray = [];

//This function is used to encode the components of the ecommerce object.
function encodeEntry(key,value) {
    return encodeUriComponent(key) + "=" + encodeUriComponent(value);
}

//
if (tagType == "container") {
  let url = "";
  if(cdCheckbox1 == true){
    url = "https://cdn." + encodeUriComponent(cd1) + "/" + encodeUriComponent(aID) + ".js";
    log("Pepperjam: Container script loaded successfully: " + url);
  }else{
    url = "https://container.pepperjam.com/" + encodeUriComponent(aID) + ".js";
    log("Pepperjam: Container script loaded successfully: " + url);
  }

  // If the script loaded successfully, log a message and signal success
  const onSuccess = () => {
    data.gtmOnSuccess();
  };

  // If the script fails to load, log a message and signal failure
  const onFailure = () => {
    data.gtmOnFailure();
  };

  // If the URL input by the user matches the permissions set for the template,
  // inject the script with the onSuccess and onFailure methods as callbacks.
  if (queryPermission("inject_script", url)) {
    injectScript(url, onSuccess, onFailure);
  } else {
    data.gtmOnFailure();
  }
} else {
  //CONVERSION TAG
  //IF THE USER IS USING GTM'S UA DATA LAYER
  if (dataLayerType == "gtm") {
    const transactionID = getDL("ecommerce.purchase.actionField.id");
    urlSRC.push(encodeEntry("ORDER_ID",transactionID));
    const products = getDL("ecommerce.purchase.products");
    //CHECKS IF THE USER HAS ENABLED ITEM CATEGORY
    if (categoryCheckbox == true) {
      products.forEach(function(pi, index) {
        if (pi.id) {
          urlSRC.push(encodeEntry("ITEM_ID" + (index + 1), makeString(pi.id)));
        }
        if (typeof(pi.price) != "undefined") {
          urlSRC.push(encodeEntry("ITEM_PRICE" + (index + 1), makeString(pi.price)));
        }
        if (pi.quantity) {
          urlSRC.push(encodeEntry("QUANTITY" + (index + 1),makeString(pi.quantity)));
        }
        if (pi.category) {
          urlSRC.push(encodeEntry("CATEGORY" + (index + 1), makeString(pi.category)));
        }
      });
    } else {
      products.forEach(function(pi, index) {
        if (pi.id) {
          urlSRC.push(encodeEntry("ITEM_ID" + (index + 1), makeString(pi.id)));
        }
        if (typeof(pi.price) != "undefined") {
          urlSRC.push(encodeEntry("ITEM_PRICE" + (index + 1), makeString(pi.price)));
        }
        if (pi.quantity) {
          urlSRC.push(encodeEntry("QUANTITY" + (index + 1),makeString(pi.quantity)));
        }
      });
    }
    //ADDS urlSRC TO THE urlSRC ARRAY
    //urlSRC.push(urlSRC.join("&"));

    //CHECKS IF THE USER HAS ENABLED COUPONS
    if (couponCheckbox == true) {
      const couponTransaction = getDL("ecommerce.purchase.actionField.coupon");
      if (couponTransaction != undefined && couponTransaction.length > 0) {

        couponArray.push(makeString(couponTransaction));
      }
      products.forEach(function(pi, index) {
        if (pi.coupon) {
          couponArray.push(makeString(pi.coupon));

        }
      });
      if (couponArray.length > 0) {
        urlSRC.push(encodeEntry("COUPON",couponArray.join(",")));
      }
    }

    //CHECKS IF THE USER HAS ENABLED USER TYPE
    if (userTypeValidation == true) {
      urlSRC.push(encodeEntry("NEW_TO_FILE",makeString(userType)));
    }

    //CHECKS IF THE USER HAS ENABLED PIXEL TYPE
    if (pixelTypeValidation == true) {
      urlSRC.push(encodeEntry("TYPE",makeString(pixelType)));
    } else {
      urlSRC.push("TYPE=1");
    }
    
    //ADDS CURRENCY
    if (currencyCheckbox == true) {
      urlSRC.push(encodeEntry("CURRENCY",makeString(currency)));
    }
    
    //CHECKS IF THE USER HAS ENABLED SEGMENT
    if (segment == true) {
      urlSRC.push(encodeEntry("SEGMENT",makeString(segmentType)));
    }
    
    //Create URL
    let url = "";
    if(cdCheckbox2 == true){
      url = "https://" + encodeUriComponent(cd2) + "/track?INT=DYNAMIC&PROGRAM_ID=" + encodeUriComponent(programID) + "&" + urlSRC.join("&");
      //log("Pepperjam: Conversion url: " + url);
    }else{
      url = "https://t.pepperjamnetwork.com/track?INT=DYNAMIC&PROGRAM_ID=" + encodeUriComponent(programID) + "&" + urlSRC.join("&");
      //log("Pepperjam: Conversion url: " + url);
  }
    
    // If the script loaded successfully, log a message and signal success
    const onSuccess = () => {
      data.gtmOnSuccess();
    };

    // If the script fails to load, log a message and signal failure
    const onFailure = () => {
      data.gtmOnFailure();
    };

    // If the URL input by the user matches the permissions set for the template,
    // inject the script with the onSuccess and onFailure methods as callbacks.
    if (queryPermission("inject_hidden_iframe", url)) {
      injectIframe(url, onSuccess);
    } else {
      data.gtmOnFailure();
    }

    //---------------------------------------------------------------------------------------------//
    //----------------------------------------GA4 Data Layer---------------------------------------//
    //---------------------------------------------------------------------------------------------//

    }else if (dataLayerType == "gtm_ga4") {
        const transactionID = getDL("ecommerce.transaction_id");
        urlSRC.push(encodeEntry("ORDER_ID",transactionID));
        const products = getDL("ecommerce.items");
        //CHECKS IF THE USER HAS ENABLED ITEM CATEGORY
        if (categoryCheckbox == true) {
          products.forEach(function(pi, index) {
            if (pi.item_id) {
              urlSRC.push(encodeEntry("ITEM_ID" + (index + 1), makeString(pi.item_id)));
            }
            /*if (pi.discount) {
              urlSRC.push(encodeEntry("DISCOUNT" + (index + 1), makeString(pi.discount)));
            }*/
            if (typeof(pi.price) != "undefined") {
              if (pi.discount == "" || pi.discount == 0) {
                urlSRC.push(encodeEntry("ITEM_PRICE" + (index + 1), makeString(pi.price)));
                }  else {
                //log("ITEM_DISCOUNT" + (index + 1) +" : "+pi.discount);
                pi.price = pi.price - pi.discount;
                urlSRC.push(encodeEntry("ITEM_PRICE" + (index + 1), makeString(pi.price)));
              }
            }
            if (pi.quantity) {
              urlSRC.push(encodeEntry("QUANTITY" + (index + 1),makeString(pi.quantity)));
            }
            if (pi.item_category) {
              urlSRC.push(encodeEntry("CATEGORY" + (index + 1), makeString(pi.item_category)));
            }
          });
        } else {
          products.forEach(function(pi, index) {
            if (pi.item_id) {
              urlSRC.push(encodeEntry("ITEM_ID" + (index + 1), makeString(pi.item_id)));
            }
            if (typeof(pi.price) != "undefined") {
              urlSRC.push(encodeEntry("ITEM_PRICE" + (index + 1), makeString(pi.price)));
            }
            if (pi.quantity) {
              urlSRC.push(encodeEntry("QUANTITY" + (index + 1),makeString(pi.quantity)));
            }
          });
        }
        //ADDS urlSRC TO THE urlSRC ARRAY
        //urlSRC.push(urlSRC.join("&"));
    
        //CHECKS IF THE USER HAS ENABLED COUPONS
        if (couponCheckbox == true) {
          const couponTransaction = getDL("ecommerce.coupon");
          if (couponTransaction != undefined && couponTransaction.length > 0) {
    
            couponArray.push(makeString(couponTransaction));
          }
          products.forEach(function(pi, index) {
            if (pi.coupon) {
              couponArray.push(makeString(pi.coupon));
    
            }
          });
          if (couponArray.length > 0) {
            urlSRC.push(encodeEntry("COUPON",couponArray.join(",")));
          }
        }
    
        //CHECKS IF THE USER HAS ENABLED USER TYPE
        if (userTypeValidation == true) {
          urlSRC.push(encodeEntry("NEW_TO_FILE",makeString(userType)));
        }
    
        //CHECKS IF THE USER HAS ENABLED PIXEL TYPE
        if (pixelTypeValidation == true) {
          urlSRC.push(encodeEntry("TYPE",makeString(pixelType)));
        } else {
          urlSRC.push("TYPE=1");
        }
        
        //ADDS CURRENCY
        if (currencyCheckbox == true) {
          urlSRC.push(encodeEntry("CURRENCY",makeString(currency)));
        }
        
        //CHECKS IF THE USER HAS ENABLED SEGMENT
        if (segment == true) {
          urlSRC.push(encodeEntry("SEGMENT",makeString(segmentType)));
        }
        
        //Create URL
        let url = "";
        if(cdCheckbox2 == true){
          url = "https://" + encodeUriComponent(cd2) + "/track?INT=DYNAMIC&PROGRAM_ID=" + encodeUriComponent(programID) + "&" + urlSRC.join("&");
          //log("Pepperjam: Conversion url: " + url);
        }else{
          url = "https://t.pepperjamnetwork.com/track?INT=DYNAMIC&PROGRAM_ID=" + encodeUriComponent(programID) + "&" + urlSRC.join("&");
          //log("Pepperjam: Conversion url: " + url);
      }
        
        // If the script loaded successfully, log a message and signal success
        const onSuccess = () => {
          data.gtmOnSuccess();
        };
    
        // If the script fails to load, log a message and signal failure
        const onFailure = () => {
          data.gtmOnFailure();
        };
    
        // If the URL input by the user matches the permissions set for the template,
        // inject the script with the onSuccess and onFailure methods as callbacks.
        if (queryPermission("inject_hidden_iframe", url)) {
          injectIframe(url, onSuccess);
        } else {
          data.gtmOnFailure();
        }
    //---------------------------------------------------------------------------------------------//
    //-----------------------------------------USER DEFINED----------------------------------------//
    //---------------------------------------------------------------------------------------------//
    
    } else if (dataLayerType == "udv") {
    //log("UDV Transaction ID:" + userVar.ecommerce.purchase.actionField.id);
    const transactionID = userVar.ecommerce.purchase.actionField.id;
    urlSRC.push(encodeEntry("ORDER_ID",transactionID));
    const products = userVar.ecommerce.purchase.products;
    //CHECKS IF THE USER HAS ENABLED ITEM CATEGORY
    if (categoryCheckbox == true) {
      products.forEach(function(pi, index) {
        if (pi.id) {
          urlSRC.push(encodeEntry("ITEM_ID" + (index + 1), makeString(pi.id)));
        }
        if (typeof(pi.price) != "undefined") {
          urlSRC.push(encodeEntry("ITEM_PRICE" + (index + 1), makeString(pi.price)));
        }
        if (pi.quantity) {
          urlSRC.push(encodeEntry("QUANTITY" + (index + 1),makeString(pi.quantity)));
        }
        if (pi.category) {
          urlSRC.push(encodeEntry("CATEGORY" + (index + 1), makeString(pi.category)));
        }
      });
    } else {
      products.forEach(function(pi, index) {
        if (pi.id) {
          urlSRC.push(encodeEntry("ITEM_ID" + (index + 1), makeString(pi.id)));
        }
        if (typeof(pi.price) != "undefined") {
          urlSRC.push(encodeEntry("ITEM_PRICE" + (index + 1), makeString(pi.price)));
        }
        if (pi.quantity) {
          urlSRC.push(encodeEntry("QUANTITY" + (index + 1),makeString(pi.quantity)));
        }
      });
    }
    //ADDS urlSRC TO THE urlSRC ARRAY
    //urlSRC.push(urlSRC.join("&"));

    //CHECKS IF THE USER HAS ENABLED COUPONS
    if (couponCheckbox == true) {
      const couponTransaction = userVar.ecommerce.purchase.actionField.coupon;
      if (couponTransaction != undefined && couponTransaction.length > 0) {
        couponArray.push(makeString(couponTransaction));
      }
      products.forEach(function(pi, index) {
        if (pi.coupon) {
          couponArray.push(makeString(pi.coupon));
        }
      });
      if (couponArray.length > 0) {
        urlSRC.push(encodeEntry("COUPON",couponArray.join(",")));
      }
    }

    //CHECKS IF THE USER HAS ENABLED USER TYPE
    if (userTypeValidation == true) {
      urlSRC.push(encodeEntry("NEW_TO_FILE",makeString(userType)));
    }

    //CHECKS IF THE USER HAS ENABLED PIXEL TYPE
    if (pixelTypeValidation == true) {
      urlSRC.push(encodeEntry("TYPE",makeString(pixelType)));
    } else {
      urlSRC.push("TYPE=1");
    }
    
    //ADDS CURRENCY
    if (currencyCheckbox == true) {
      urlSRC.push(encodeEntry("CURRENCY",makeString(currency)));
    }
    //CHECKS IF THE USER HAS ENABLED SEGMENT
    if (segment == true) {
      urlSRC.push(encodeEntry("SEGMENT",makeString(segmentType)));
    }
    
    //Create URL
    let url = "";
    if(cdCheckbox2 == true){
      url = "https://" + encodeUriComponent(cd2) + "/track?INT=DYNAMIC&PROGRAM_ID=" + encodeUriComponent(programID) + "&" + urlSRC.join("&");
    }else{
      url = "https://t.pepperjamnetwork.com/track?INT=DYNAMIC&PROGRAM_ID=" + encodeUriComponent(programID) + "&" + urlSRC.join("&");
  }

    // If the script loaded successfully, log a message and signal success
    const onSuccess = () => {
      //log("Pepperjam: Conversion script loaded successfully.");
      data.gtmOnSuccess();
    };

    // If the script fails to load, log a message and signal failure
    const onFailure = () => {
      data.gtmOnFailure();
    };

    // If the URL input by the user matches the permissions set for the template,
    // inject the script with the onSuccess and onFailure methods as callbacks.
    if (queryPermission("inject_hidden_iframe", url)) {
      injectIframe(url, onSuccess);
    } else {
      data.gtmOnFailure();
    }
  }
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_hidden_iframe",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://t.pepperjamnetwork.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedKeys",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "ecommerce.*"
              },
              {
                "type": 1,
                "string": "ecommerce.purchase.*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://container.pepperjam.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Inject Container Library
  code: |
    // Call runCode to run the template's code.
    runCode('containerMock');

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: Inject Conversion Library
  code: |-
    // Call runCode to run the template's code.
    runCode('conversionUDMock');

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
setup: |-
  const containerMock = {
    tagType: 'container',
    advertiserID: 3423209508,
    customDomainCheckbox1: 'false'
  };


  const conversionGTMMock = {
    tagType: 'conversion',
    programID: 9567,
    customDomainCheckbox2: 'false',
    dataLayerType: 'gtm',
    pixelTypeValidation: 'false',
    userTypeValidation: 'false',
    categoryCheckbox: 'true',
    couponCheckbox: 'true',
    segment: 'false'
  };

  const conversionUDMock = {
    tagType: 'conversion',
    programID: 9567,
    customDomainCheckbox2: 'false',
    dataLayerType: 'udv',
    userVar: [{}],
    pixelTypeValidation: 'false',
    userTypeValidation: 'false',
    categoryCheckbox: 'true',
    couponCheckbox: 'true',
    segment: 'false'
  };

  const mockEec = {
      ecommerce: {
      purchase: {
        actionField: {
          id: 'T12345',
          affiliation: 'Online Store',
          revenue: '35.43',
          tax:'4.90',
          shipping: '5.99',
          coupon: 'SUMMER_SALE'
        },
        products: [{
          name: 'TA T-Shirt',
          id: '12345',
          price: '15.25',
          brand: 'OP',
          category: 'Apparel',
          variant: 'Gray',
          quantity: 1,
          coupon: ''
         },
         {
          name: 'DFS T-Shirt',
          id: '67890',
          price: '33.75',
          brand: 'OP',
          category: 'Apparel',
          variant: 'Black',
          quantity: 1
         }]
      }
    }
  };

  // Create injectScript mock
  let success, failure;
  mock('injectScript', (url, onsuccess, onfailure) => {
    success = onsuccess;
    failure = onfailure;
    onsuccess();
  });


___NOTES___

Created on 6/15/2020, 1:31:11 PM


